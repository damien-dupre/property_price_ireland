---
title: Evaluation of property price fluctuaction according to geographical landmarks, an Dublin case study
author:
  - name: Damien Dupr√©
    email: damien.dupre@dcu.ie
    affiliation: Dublin City University
    footnote: Corresponding Author
address:
  - code: Dublin City University
    address: Business School, Glasnevin, Dublin 9, Ireland 
abstract: |
  This is the abstract.

journal: "An awesome journal"
date: "`r Sys.Date()`"
bibliography: mybibfile.bib
output: rticles::elsevier_article
header-includes:
  - \usepackage{float}
  - \usepackage{booktabs}
  - \usepackage{array}
  - \usepackage{tabu}
  - \floatplacement{figure}{H}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  cache.extra = knitr::rand_seed, 
  message = FALSE, 
  warning = FALSE, 
  error = FALSE, 
  echo = FALSE,
  fig.pos = 'H')
# options
options(scipen=999)
# tools
library(here)
library(lubridate)
library(readr)
library(papaja)
# data wrangling
library(plyr)
library(dplyr)
# table design
library(kableExtra)
# figure design
library(ggplot2)
library(ggpubr)
library(ggridges)
library(ggpmisc)
# map tools
library(sf)
library(tmap)
library(lwgeom)
library(osmdata)
library(OpenStreetMap)
# statistical analysis
library(mgcv)
library(xgboost)
# custom function
source(here::here("script/my_viz.R"))
```

```{r data_upload}
data_raw <- readr::read_csv(here::here("data/PPR-ALL.csv")) %>%
  dplyr::rename(
    date_of_sale = `Date of Sale (dd/mm/yyyy)`,
    price = `Price (<U+0080>)`
  ) %>%
  dplyr::mutate(price = readr::parse_number(price)) %>%
  dplyr::mutate(date_of_sale = as.Date(date_of_sale, format = "%d/%m/%Y")) %>%
  dplyr::mutate(full_address = paste(Address, County, "Ireland")) %>%
  tibble::rowid_to_column("sale_id") %>%
  dplyr::mutate(year = lubridate::year(date_of_sale))

data_dublin <- data_raw %>%
  dplyr::filter(County == "Dublin")

data_dublin_geocoded_clean <-
  readr::read_rds(here::here("data/data_dublin_geocoded_clean.rds")) %>%
  dplyr::mutate(year_fact = as.factor(as.character(year)))

mean_dat <- mean(data_dublin_geocoded_clean$price)
sd_dat <- sd(data_dublin_geocoded_clean$price)

data_dublin_geocoded_clean <- data_dublin_geocoded_clean %>%
  dplyr::filter(price > mean_dat - sd_dat)# %>%
  #dplyr::filter(price < mean_dat + sd_dat)
```

```{r dublin-area}
# https://www.fromthebottomoftheheap.net/2016/03/27/soap-film-smoothers/
# https://github.com/eric-pedersen/mgcv-esa-workshop/blob/master/example-spatial-mexdolphins-solutions.Rmd
# http://distancesampling.org/R/vignettes/mexico-analysis.html
################################################################################
#                         get Dublin GPS box                                   #
################################################################################
# https://wiki.openstreetmap.org/wiki/Map_Features
boundaries_dublin <- 
  osmdata::opq(bbox = 'Dublin, Ireland') %>%
  osmdata::add_osm_feature(key = 'admin_level', value = '7') %>%
  osmdata::osmdata_sf() %>% 
  osmdata::unique_osmdata()

bb <- st_bbox(boundaries_dublin$osm_multipolygons$geometry)
# Defining a buffer
buffer <- 0.1
p_big <- rbind(c(bb[1] - buffer, bb[2] - buffer),
               c(bb[1] - buffer, bb[4] + buffer),
               c(bb[3] + buffer, bb[4] + buffer),
               c(bb[3] + buffer, bb[2] - buffer),
               c(bb[1] - buffer, bb[2] - buffer))
# Putting the coordinates into a squared polygon object
pol_dublin <- st_polygon(list(p_big)) %>% st_geometry
# Providing the SRID (here, unprojected lon/lat)
st_crs(pol_dublin) <- 4326
################################################################################
#                            get Dublin coast line                             #
################################################################################
coast_dublin <- opq(bbox = st_bbox(pol_dublin)) %>%
  add_osm_feature(key = 'natural', value = 'coastline') %>%
  osmdata_sf %>% unique_osmdata

blade_dublin <- coast_dublin$osm_lines$geometry %>% st_union %>% st_line_merge

ls <- st_linestring(blade_dublin[[1]][[1]])

multipol <- st_split(st_geometry(pol_dublin), st_geometry(ls))
```

Introduction
==========================

To acquire a property is one of the most important achievement that individuals are seeking. It provides not only a housing security but also the feeling of being a landowner. However the access to the status of landowner is complicated because buying a property is the most expensive spending of in a lifetime. For this reason understanding the factors which are explaining how property prices evolve is a necessity.

Due to its geographic, economic and political situation, Ireland in general and Dublin in particular saw important changes in property prices in the last ten years. From a economic boom known as the "Celtic tiger" in the 2000's, Ireland were deeply impacted by the 2007 economic crisis. With an expected GDP growth of 4% for 2019, property prices are back to their highest. Whereas this grow is moderated in Irish mainland, its capital Dublin is at the center of a housing crisis. Because of factors including Irish economic wealth, the presence of tech companies European headquarters such as Facebook or Google and the historic configuration of the city which low population density structure and underdeveloped public transportation, property prices became unaffordable to most of Irish families.

In this paper we want to identify the spatio-temporal factors that influenced the evolution of Dublin property prices. More precisely we want to highlight not only macro economical influences such as GDP but also the presence of economical landmarks such as tech companies headquarters and public transportation system on property prices evolution.

Method
==========================

Since the 1st January 2010, under the Property Services (Regulation) Act, all individuals acquiring a property in Ireland has to declare it to Property Services Regulatory Authority (PSRA). It includes Date of Sale, Price and Address of all residential properties purchased in Ireland as declared to the Revenue Commissioners for stamp duty purposes (https://propertypriceregister.ie). It must be noticed that data is filed electronically by persons doing the conveyancing of the property on behalf of the purchaser and errors may occur when the data is being filed. In order to evaluate the spacial distribution of the property sold, a geocoding from the filled addresses to GPS coordinated was performed using the OpenStreetMap API.

```{r dublin-sample-size, results="asis"}
data_dublin_geocoded_clean %>%
  dplyr::count(year) %>%
  kable(
    "latex",
    caption = "Size of the PSRA database for properties sold in Dublin County per year since 2010 aftering filtering the orignal database.",
    booktabs = T,
    digits = 2,
    linesep = ""
  ) %>%
  kable_styling(font_size = 8,
                latex_options = c("hold_position"))
```

By focusing on the property sold in Dublin, `r nrow(data_dublin)` entries were recorded since 2010. After having filtered properties not corresponding to houses, properties for which address was not possible to geocode, artifacts in geocodes and aberrant value in sales price. From the self-reported database, `r nrow(data_dublin_geocoded_clean)` properties sold in Dublin between `r min(data_dublin_geocoded_clean$date_of_sale)` and `r max(data_dublin_geocoded_clean$date_of_sale)` was geocoded. 